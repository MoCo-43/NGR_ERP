<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yedam.erp.mapper.hr.EmpMapper">

	<resultMap id="EmpMap" type="com.yedam.erp.vo.hr.EmpVO">
		<id property="emp_id" column="emp_id" />
		<result property="name" column="name" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="position" column="position" />
		<result property="title" column="title" />
		<result property="birth" column="birth" />
		<result property="phone" column="phone" />
		<result property="email" column="email" />
		<result property="joinDate" column="joinDate" />
		<result property="leaveDate" column="leaveDate" />
		<result property="leaveReason" column="leaveReason" />
		<result property="bankCode" column="bankCode" />
		<result property="accountNo" column="accountNo" />
		<result property="zipCode" column="zipCode" />
		<result property="address" column="address" />
	</resultMap>

	<select id="selectEmpList"
        parameterType="com.yedam.erp.vo.hr.EmpVO" resultMap="EmpMap">
  SELECT
      e.EMP_ID      AS emp_id,
      e.NAME        AS name,
      e.DEPT_CODE   AS dept_code,
      d.DEPT_NAME   AS dept_name,  -- ✅ 부서명
      e.POSITION    AS position,
      e.TITLE       AS title,
      e.BIRTH       AS birth,
      e.PHONE       AS phone,
      e.EMAIL       AS email,
      e.JOIN_DATE   AS joinDate,
      e.LEAVE_DATE  AS leaveDate,
      e.LEAVE_REASON AS leaveReason,
      e.BANK_CODE   AS bankCode,
      e.ACCOUNT_NO  AS accountNo,
      e.ZIP_CODE    AS zipCode,
      e.ADDRESS     AS address
  FROM EMP e
  LEFT JOIN DEPT d ON e.DEPT_CODE = d.DEPT_CODE  
  <where>
    <if test="dept_code != null and dept_code != ''">
      AND e.DEPT_CODE = #{dept_code}
    </if>
    <if test="emp_id != null and emp_id != ''">
      AND e.EMP_ID LIKE '%' || #{emp_id} || '%'
    </if>
    <if test="name != null and name != ''">
      AND e.NAME LIKE '%' || #{name} || '%'
    </if>
  </where>
  ORDER BY e.EMP_ID DESC
</select>
<select id="selectEmp" parameterType="com.yedam.erp.vo.hr.EmpVO" resultMap="EmpMap">
  SELECT
      e.EMP_ID      AS emp_id,
      e.NAME        AS name,
      e.DEPT_CODE   AS dept_code,
      d.DEPT_NAME   AS dept_name,  -- ✅ 부서명
      e.POSITION    AS position,
      e.TITLE       AS title,
      e.BIRTH       AS birth,
      e.PHONE       AS phone,
      e.EMAIL       AS email,
      e.JOIN_DATE   AS joinDate,
      e.LEAVE_DATE  AS leaveDate,
      e.LEAVE_REASON AS leaveReason,
      e.BANK_CODE   AS bankCode,
      e.ACCOUNT_NO  AS accountNo,
      e.ZIP_CODE    AS zipCode,
      e.ADDRESS     AS address
  FROM EMP e
  LEFT JOIN DEPT d ON e.DEPT_CODE = d.DEPT_CODE  <!-- ✅ 조인 추가 -->
  WHERE e.EMP_ID = #{emp_id}
</select>

	<insert id="insertEmp" parameterType="com.yedam.erp.vo.hr.EmpVO">
		INSERT INTO EMP (
		NAME, DEPT_CODE, POSITION, TITLE, BIRTH, PHONE, EMAIL,
		JOIN_DATE, LEAVE_DATE, LEAVE_REASON, BANK_CODE, ACCOUNT_NO,
		ZIP_CODE, ADDRESS
		) VALUES (
		#{name}, #{dept_code}, #{position}, #{title}, #{birth}, #{phone}, #{email},
		#{joinDate}, #{leaveDate}, #{leaveReason}, #{bankCode}, #{accountNo},
		#{zipCode}, #{address}
		)
		<!-- 필요 시: RETURNING EMP_ID INTO #{emp_id} -->
	</insert>

	<update id="updateEmp" parameterType="com.yedam.erp.vo.hr.EmpVO">
		UPDATE EMP
		<set>
			<if test="name != null"> NAME = #{name},</if>
			<if test="dept_code != null"> DEPT_CODE = #{dept_code},</if>
			<if test="position != null"> POSITION = #{position},</if>
			<if test="title != null"> TITLE = #{title},</if>
			<if test="birth != null"> BIRTH = #{birth},</if>
			<if test="phone != null"> PHONE = #{phone},</if>
			<if test="email != null"> EMAIL = #{email},</if>
			<if test="joinDate != null"> JOIN_DATE = #{joinDate},</if>
			<if test="leaveDate != null"> LEAVE_DATE = #{leaveDate},</if>
			<if test="leaveReason != null"> LEAVE_REASON = #{leaveReason},</if>
			<if test="bankCode != null"> BANK_CODE = #{bankCode},</if>
			<if test="accountNo != null"> ACCOUNT_NO = #{accountNo},</if>
			<if test="zipCode != null"> ZIP_CODE = #{zipCode},</if>
			<if test="address != null"> ADDRESS = #{address},</if>
		</set>
		WHERE EMP_ID = #{emp_id}
	</update>

</mapper>
