<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yedam.erp.mapper.hr.EmpPayFixMapper">

  <!-- ResultMap: 컬럼 → EmpPayFixVO 필드 매핑 -->
  <resultMap id="EmpPayFixMap" type="com.yedam.erp.vo.hr.EmpPayFixVO">
    <id     property="payFixNo"      column="pay_fix_no"/>
    <result property="empId"         column="emp_id"/>
    <result property="empAllowCode"  column="emp_allow_code"/>
    <result property="empAllowLabel" column="emp_allow_label"/>
    <result property="empAllowPay"   column="emp_allow_pay"/>
    <result property="companyCode"   column="company_code"/>
  </resultMap>

  <!-- 활성 수당 목록 + 사원 저장값(없으면 0/라벨은 기본명) -->
  <select id="selectAllowList" resultMap="EmpPayFixMap">
    SELECT
        e.pay_fix_no,
        e.emp_id,
        a.allow_code                                     AS emp_allow_code,
        COALESCE(e.emp_allow_label, a.allow_name)        AS emp_allow_label,
        NVL(e.emp_allow_pay, 0)                          AS emp_allow_pay,
        a.company_code                                   AS company_code
    FROM pay_allow_code a
    LEFT JOIN emp_pay_fix e
      ON e.company_code   = a.company_code
     AND e.emp_id         = #{empId}
     AND e.emp_allow_code = a.allow_code
    WHERE a.use_yn = 'Y'
      AND a.company_code = #{companyCode}
    ORDER BY a.allow_code
  </select>

  <!-- 사원 수당 등록 (INSERT) -->
  <insert id="insertEmpPayFix" parameterType="com.yedam.erp.vo.hr.EmpPayFixVO">
    INSERT INTO emp_pay_fix (
        pay_fix_no,
        emp_id,
        emp_allow_code,
        emp_allow_label,
        emp_allow_pay,
        company_code
    ) VALUES (
        SEQ_EMP_PAY_FIX.NEXTVAL,      <!-- 필요 시 CLOUD.SEQ_EMP_PAY_FIX.NEXTVAL -->
        #{empId},
        #{empAllowCode},
        #{empAllowLabel},
        #{empAllowPay},
        #{companyCode}
    )
  </insert>

  <!-- 사원 수당 수정 (UPDATE) -->
  <update id="updateEmpPayFix" parameterType="com.yedam.erp.vo.hr.EmpPayFixVO">
    UPDATE emp_pay_fix
       SET emp_allow_label = #{empAllowLabel},
           emp_allow_pay   = #{empAllowPay}
     WHERE emp_id          = #{empId}
       AND emp_allow_code  = #{empAllowCode}
       AND company_code    = #{companyCode}
  </update>

</mapper>
