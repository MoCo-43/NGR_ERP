<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>

  <!-- Bootstrap & FontAwesome (UI용) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"/>
  <style>
  
  </style>
</head>
<body>
<div th:fragment="invoiceModal">
  <div class="modal fade" id="invoiceModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">매출/매입 전표</h5>
          <button type="button" class="btn btn-light btn-sm border-0" data-bs-dismiss="modal" aria-label="닫기">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body">
          <!-- 전표 기본정보 -->
          <div class="row mb-2">
            <div class="col-md-3">
              <label class="form-label">전표일자</label>
              <!-- ✅ 오늘 날짜가 기본값, 변경 가능 -->
              <input type="date" class="form-control" id="invoiceDate"
                     th:value="${invoiceHeader?.invoiceDate}"/>
            </div>
            <div class="col-md-4">
              <label class="form-label">주문서</label>
              <div class="input-group">
                <input type="text" class="form-control" th:value="${invoiceHeader?.orderCode}" readonly/>
                <button class="btn btn-outline-secondary btn-icon" type="button">
                  <i class="fas fa-search"></i>
                </button>
              </div>
            </div>
            <div class="col-md-5">
              <label class="form-label">부서명</label>
              <div class="input-group">
                <input type="text" class="form-control" th:value="${invoiceHeader?.deptCode}" readonly/>
                <button class="btn btn-outline-secondary btn-icon" type="button">
                  <i class="fas fa-search"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="row mb-2">
            <div class="col-md-4">
              <label class="form-label">부가세 유형</label>
              <select class="form-select-invoice" th:value="${invoiceHeader?.vatType}">
                <option value="과세">세금계산서</option>
                <option value="영세">영세율</option>
                <option value="면세">면세</option>
              </select>
            </div>

            <!-- 거래처 -->
            <div class="col-md-8">
              <label class="form-label">거래처</label>
              <div class="input-group">
                <input type="text" class="form-control" id="cusCodeInput"
                       th:value="${invoiceHeader?.cusCode}" placeholder="코드" readonly/>
                <button class="btn btn-outline-secondary btn-icon" type="button" id="openBusinessModalBtn">
                  <i class="fas fa-search"></i>
                </button>
                <input type="text" class="form-control" id="cusNameInput"
                       th:value="${invoiceHeader?.cusName}" placeholder="거래처명" readonly/>
              </div>
            </div>
          </div>

          <!-- 품목 Grid -->
          <div id="invoiceGrid" class="ag-theme-quartz"></div>

          <!-- 세부내역 -->
          <div class="mb-2 mt-3">
            <label class="form-label">세부내역</label>
            <textarea class="form-control" rows="3" th:text="${invoiceHeader?.memo}"></textarea>
          </div>

          <!-- 결제방식 / 적요 -->
          <div class="row mb-2">
            <div class="col-md-6">
              <label class="form-label">결제방식</label>
              <input type="text" class="form-control" th:value="${invoiceHeader?.payMethod}"/>
            </div>
            <div class="col-md-6">
              <label class="form-label">적요</label>
              <input type="text" class="form-control" th:value="${invoiceHeader?.note}"/>
            </div>
          </div>

          <!-- 계정과목 -->
          <div class="row mb-2">
            <div class="col-md-6">
              <label class="form-label">매출/매입 계정</label>
              <div class="input-group">
                <input type="text" class="form-control" th:value="${invoiceHeader?.arApAcct}" placeholder="코드"/>
                <button class="btn btn-outline-secondary btn-icon" type="button">
                  <i class="fas fa-search"></i>
                </button>
                <input type="text" class="form-control" placeholder="계정과목명"/>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label">자금 계좌</label>
              <div class="input-group">
                <input type="text" class="form-control" th:value="${invoiceHeader?.cashAccount}" placeholder="코드"/>
                <button class="btn btn-outline-secondary btn-icon" type="button">
                  <i class="fas fa-search"></i>
                </button>
                <input type="text" class="form-control" placeholder="계좌번호"/>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-success" type="button">저장</button>
          <button class="btn btn-danger" type="button" data-bs-dismiss="modal">닫기</button>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- ✅ 오늘 날짜 기본값 세팅 스크립트 -->
<script th:inline="none">
document.addEventListener("DOMContentLoaded", () => {
  const dateInput = document.getElementById("invoiceDate");
  if (dateInput && !dateInput.value) {
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, "0");
    const dd = String(today.getDate()).padStart(2, "0");
    dateInput.value = `${yyyy}-${mm}-${dd}`;
  }
});
</script>

</body>
</html>
