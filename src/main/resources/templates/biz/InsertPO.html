<!DOCTYPE html>
<html
  lang="ko"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/base}"
>
  <head>
    <title layout:fragment="title">ì£¼ë¬¸ì„œ ì…ë ¥</title>

    <th:block layout:fragment="head_extra">
      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.3.1/styles/ag-grid.css"
      />
      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.3.1/styles/ag-theme-quartz.css"
      />

      <style>
        .form-label {
          font-weight: 600;
        }
        .btn-slim {
          padding: 0.375rem 0.75rem;
        }
        .btn-wide {
          min-width: 110px;
        }
        .muted {
          font-size: 12px;
          color: #6b7280;
        }
        #itemGrid.ag-theme-quartz {
          height: 380px;
          width: 100%;
        }
        .rounded-box {
          border: 1px solid #e5e7eb;
          border-radius: 0.75rem;
          padding: 1rem;
        }
        .ag-theme-quartz .ag-row-pinned {
          font-weight: 700;
          background: #fafafa;
        }
      </style>
    </th:block>
  </head>

  <body>
    <section layout:fragment="content">
      <!-- ìƒë‹¨ íˆ´ë°” (8) -->
      <div class="card shadow mb-3">
        <div class="card-body d-flex align-items-center gap-2 flex-wrap">
          <div class="btn-group">
            <button
              id="btnOpenProduct"
              type="button"
              class="btn btn-outline-secondary btn-slim"
              data-bs-toggle="modal"
              data-bs-target="#productcodeModal"
            >
              í’ˆëª©ì½”ë“œ
            </button>
            <button
              id="btnOpenHistory"
              type="button"
              class="btn btn-outline-secondary btn-slim"
              data-bs-toggle="modal"
              data-bs-target="#PoHistoryModal"
            >
              ì£¼ë¬¸ì„œì´ë ¥ì¡°íšŒ
            </button>
          </div>
          <div class="ml-auto"></div>
          <button
            id="btnReset"
            type="button"
            class="btn btn-danger btn-slim btn-wide"
          >
            ì´ˆê¸°í™”
          </button>
          <button
            id="btnSubmit"
            type="button"
            class="btn btn-primary btn-slim btn-wide"
          >
            ë“±ë¡
          </button>
        </div>
      </div>

      <!-- ì…ë ¥ì˜ì—­ (1~7,10) -->
      <div class="card shadow mb-4">
        <div class="card-body">
          <div class="rounded-box">
            <!-- 1 ì‘ì„±ì¼ì / 2 ê±°ë˜ì²˜ -->
            <div class="form-row align-items-center">
              <div class="form-group col-md-3">
                <label class="form-label">ì‘ì„±ì¼ì</label>
                <input id="poStart" type="date" class="form-control" />
              </div>

              <div class="form-group col-md-5">
                <label class="form-label">ê±°ë˜ì²˜</label>
                <div class="input-group">
                  <input id="cusNo" class="form-control" disabled />
                  <div class="input-group-append">
                    <button
                      id="btnFindCustomer"
                      type="button"
                      class="btn btn-outline-secondary"
                      data-bs-toggle="modal"
                      data-bs-target="#businessModal"
                    >
                      ğŸ”
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- 3 ë‹´ë‹¹ì / 4 ê±°ë˜ìœ í˜• -->
            <div class="form-row align-items-center">
              <div class="form-group col-md-4">
                <label class="form-label">ë‹´ë‹¹ì</label>
                <div class="input-group">
                  <input
                    id="creater"
                    class="form-control"
                    placeholder="ì„¸ì…˜ë¡œê·¸ì¸ì‚¬ìš©ì"
                    disabled
                  />
                </div>
              </div>

              <div class="form-group col-md-4">
                <label class="form-label">ê±°ë˜ìœ í˜•</label>
                <select id="bizType" class="form-control">
                  <option value="VAT_INCLUDED">ë¶€ê°€ì„¸ìœ¨ ì ìš©</option>
                  <option value="VAT_EXEMPT">ë¶€ê°€ì„¸ìœ¨ ë¯¸ì ìš©</option>
                </select>
              </div>
            </div>

            <!-- 5 ë‚©ê¸°ì¼ì / 6 ë¶€ê°€ì„¸ìœ í˜• -->
            <div class="form-row align-items-center">
              <div class="form-group col-md-3">
                <label class="form-label">ë‚©ê¸°ì¼ì</label>
                <input id="exDate" type="date" class="form-control" />
              </div>

              <div class="form-group col-md-4">
                <label class="form-label">ë¶€ê°€ì„¸ìœ í˜•</label>
                <select id="vatDocType" class="form-control">
                  <option value="TAX_INVOICE">ì„¸ê¸ˆê³„ì‚°ì„œ</option>
                  <option value="STATEMENT">ëª…ì„¸ì„œ</option>
                </select>
              </div>
            </div>

            <!-- 7 ì§€ë¶ˆë°©ì‹ / 10 ê²°ì œì˜ˆì •ì¼ -->
            <div class="form-row align-items-center">
              <div class="form-group col-md-5">
                <label class="form-label d-block">ì§€ë¶ˆë°©ì‹</label>
                <div class="form-row">
                  <div class="col-auto">
                    <select id="payMethod" class="form-control">
                      <option value="CASH">í˜„ê¸ˆ</option>
                      <option value="BILL">ì–´ìŒ</option>
                      <option value="CASH_BILL">í˜„ê¸ˆ&ì–´ìŒ</option>
                    </select>
                  </div>
                  <div id="billDates" class="col d-none">
                    <div class="form-row">
                      <div class="col">
                        <input
                          id="billStart"
                          type="date"
                          class="form-control"
                          placeholder="ì–´ìŒ ì‹œì‘ì¼"
                        />
                      </div>
                      <div class="col">
                        <input
                          id="billEnd"
                          type="date"
                          class="form-control"
                          placeholder="ì–´ìŒ ë§Œê¸°ì¼"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group col-md-4">
                <label class="form-label">ê²°ì œì˜ˆì •ì¼</label>
                <input id="settleDue" type="date" class="form-control" />
              </div>
            </div>

            <!-- ìƒíƒœ/ë¹„ê³ (ì„¤ê³„ë„ ìš°ì¸¡ ì„¤ëª…ì˜ì—­ì€ ì£¼ì„ ì²˜ë¦¬ë¡œ ëŒ€ì²´) -->
            <div class="form-row">
              <div class="form-group col-md-3">
                <label class="form-label">ì²˜ë¦¬ìƒíƒœ</label>
                <select id="poStatus" class="form-control">
                  <option value="WRITTEN">ì‘ì„±ì™„ë£Œ</option>
                  <option value="DONE">ì²˜ë¦¬ì™„ë£Œ</option>
                </select>
              </div>
              <div class="form-group col-md-9">
                <label class="form-label">ë¹„ê³ </label>
                <input
                  id="notes"
                  class="form-control"
                  placeholder="íŠ¹ì´ì‚¬í•­ ë©”ëª¨"
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- í’ˆëª© ëª©ë¡ (9) -->
      <div class="card shadow">
        <div
          class="card-header d-flex align-items-center justify-content-between"
        >
          <h6 class="m-0 font-weight-bold text-primary">í’ˆëª© ëª©ë¡</h6>
          <div class="btn-group">
            <button
              id="btnAddRow"
              type="button"
              class="btn btn-outline-secondary btn-slim"
            >
              í–‰ ì¶”ê°€
            </button>
            <button
              id="btnRemoveRow"
              type="button"
              class="btn btn-outline-danger btn-slim"
            >
              í–‰ ì‚­ì œ
            </button>
          </div>
        </div>
        <div class="card-body">
          <div id="itemGrid" class="ag-theme-quartz"></div>
        </div>
      </div>

      <!-- ê±°ë˜ì²˜ ê²€ìƒ‰ ëª¨ë‹¬ -->
      <div th:replace="~{stock/modals/businessModal :: businessModal}"></div>

      <!-- í’ˆëª©ì½”ë“œ ëª¨ë‹¬ -->
      <div
        th:replace="~{biz/modals/productcodeModal :: productcodeModal}"
      ></div>

      <!-- ì£¼ë¬¸ì„œì´ë ¥ì¡°íšŒ ëª¨ë‹¬ -->
      <div th:replace="~{biz/modals/PoHistoryModal :: PoHistoryModal}"></div>
    </section>

    <th:block layout:fragment="body_extra">
      <script
        defer
        src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.3.1/dist/ag-grid-community.min.js"
      ></script>
      <script
        defer
        src="https://cdn.jsdelivr.net/npm/axios@1.7.7/dist/axios.min.js"
      ></script>

      <script th:inline="none">
        document.addEventListener("DOMContentLoaded", () => {
          // DOM helpers
          function byId(id) {
            return document.getElementById(id);
          }
          function getVal(id) {
            return byId(id)?.value ?? "";
          }
          function setVal(id, v) {
            const el = byId(id);
            if (el) el.value = v ?? "";
          }
          const toNum = (v) => Number(String(v ?? 0).replace(/[, ]/g, "")) || 0;

          // ===== ê¸°ë³¸ê°’ ì„¸íŒ… =====
          const today = new Date().toISOString().slice(0, 10);
          setVal("poStart", today);
          setVal("exDate", today);
          setVal("settleDue", today);

          // ì§€ë¶ˆë°©ì‹ í† ê¸€
          byId("payMethod").addEventListener("change", () => {
            const show = ["BILL", "CASH_BILL"].includes(getVal("payMethod"));
            byId("billDates").classList.toggle("d-none", !show);
          });

          // ê±°ë˜ìœ í˜• ë³€ê²½ ì‹œ ë¶€ê°€ì„¸ ì¬ê³„ì‚° ë° ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
          byId("bizType").addEventListener("change", () => {
            if (gridApi) {
              gridApi.refreshCells({ force: true }); // ëª¨ë“  ì…€ ê°•ì œ ìƒˆë¡œê³ ì¹¨
              updatePinned(); // í•©ê³„ í–‰ ì—…ë°ì´íŠ¸
            }
          });

          // ===== Main Grid (itemGrid) =====
          let gridApi;
          const VAT_RATE = 0.1; // 10%

          function calcSupply(r) {
            const price = toNum(r.unitPrice),
              qty = toNum(r.orderQty),
              dc = toNum(r.dcPrice);
            const gross = price * qty;
            return Math.max(gross - dc, 0);
          }
          function calcVat(r) {
            const applyVat = getVal("bizType") === "VAT_INCLUDED";
            return applyVat ? Math.round(calcSupply(r) * VAT_RATE) : 0;
          }
          function numberParser(p) {
            const n = Number(String(p.newValue || "").replace(/[, ]/g, ""));
            return isNaN(n) ? null : n;
          }
          function moneyFmt(p) {
            const n = toNum(p.value);
            if (n === 0) return "0";
            return n ? n.toLocaleString("ko-KR") : "";
          }
          function updatePinned() {
            if (!gridApi) return;
            let sumSupply = 0,
              sumVat = 0,
              sumDc = 0,
              cnt = 0;
            gridApi.forEachNodeAfterFilterAndSort((n) => {
              const r = n.data || {};
              sumSupply += calcSupply(r);
              sumVat += calcVat(r);
              sumDc += toNum(r.dcPrice);
              cnt++;
            });
            const pinned = [
              {
                dPrdName: `í•©ê³„ (í–‰ ${cnt}ê±´)`,
                supAmt: sumSupply,
                vatAmt: sumVat,
                dcPrice: sumDc,
              },
            ];
            gridApi.setPinnedBottomRowData
              ? gridApi.setPinnedBottomRowData(pinned)
              : gridApi.setGridOption("pinnedBottomRowData", pinned);
          }

          const columnDefs = [
            { headerName: "", checkboxSelection: true, width: 50 },
            {
              headerName: "í’ˆëª©ì½”ë“œ",
              field: "productCode",
              editable: true,
              width: 120,
            },
            {
              headerName: "í’ˆëª©ëª…",
              field: "dPrdName",
              editable: true,
              flex: 1,
              minWidth: 160,
            },
            {
              headerName: "ë‹¨ê°€",
              field: "unitPrice",
              editable: true,
              width: 110,
              type: "rightAligned",
              valueParser: numberParser,
              valueFormatter: moneyFmt,
            },
            {
              headerName: "ìˆ˜ëŸ‰",
              field: "orderQty",
              editable: true,
              width: 100,
              type: "rightAligned",
              valueParser: numberParser,
            },
            {
              headerName: "ê³µê¸‰ê°€ì•¡",
              field: "supAmt",
              width: 120,
              type: "rightAligned",
              valueGetter: (p) => calcSupply(p.data),
              valueFormatter: moneyFmt,
            },
            {
              headerName: "ë¶€ê°€ê°€ì¹˜ì„¸",
              field: "vatAmt",
              width: 120,
              type: "rightAligned",
              valueGetter: (p) => calcVat(p.data),
              valueFormatter: moneyFmt,
            },
            {
              headerName: "í• ì¸ê¸ˆì•¡",
              field: "dcPrice",
              editable: true,
              width: 120,
              type: "rightAligned",
              valueParser: numberParser,
              valueFormatter: moneyFmt,
            },
            {
              headerName: "ì´ì•¡",
              field: "totalPrice",
              editable: false,
              width: 160,
              valueGetter: (p) => calcSupply(p.data) + calcVat(p.data),
              valueFormatter: moneyFmt,
            },
            { headerName: "ë¹„ê³ ", field: "notes", editable: true, width: 160 },
          ];

          const gridOptions = {
            columnDefs,
            rowData: [
              {
                productCode: "A01",
                dPrdName: "ë§›ìˆëŠ”ì¿ í‚¤",
                unitPrice: 1000,
                orderQty: 100,
                dcPrice: 5000,
              },
            ],
            defaultColDef: { sortable: true, resizable: true, filter: true },
            onGridReady: (p) => {
              gridApi = p.api;
              updatePinned();
            },
            onCellValueChanged: updatePinned,
            onModelUpdated: updatePinned,
          };

          const gridDiv = byId("itemGrid");
          if (window.agGrid?.createGrid) {
            gridApi = agGrid.createGrid(gridDiv, gridOptions);
          } else {
            gridApi = gridOptions.api;
          }

          // í–‰ ì¶”ê°€/ì‚­ì œ
          byId("btnAddRow").addEventListener("click", () => {
            const blank = {
              productCode: "",
              dPrdName: "",
              unitPrice: null,
              orderQty: null,
              dcPrice: null,
              notes: "",
            };
            gridApi.applyTransaction({ add: [blank] });
            updatePinned();
          });
          byId("btnRemoveRow").addEventListener("click", () => {
            const sel = gridApi.getSelectedRows?.() || [];
            if (!sel.length) return alert("ì‚­ì œí•  í–‰ì„ ì„ íƒí•˜ì„¸ìš”.");
            gridApi.applyTransaction({ remove: sel });
            updatePinned();
          });

          // ===== ë“±ë¡ =====
          const submit = async () => {
            try {
              const row =
                gridApi.getDisplayedRowCount() > 0
                  ? gridApi.getDisplayedRowAtIndex(0).data
                  : null;
              if (!row || !row.productCode)
                return alert("ì²« ë²ˆì§¸ í–‰ì˜ í’ˆëª© ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

              const supAmt = calcSupply(row);
              const vatAmt = calcVat(row);
              const totalPrice = supAmt + vatAmt;

              const body = {
                cusNo: getVal("cusNo"),
                creater: getVal("creater"),
                poStart: getVal("poStart"),
                exDate: getVal("exDate"),
                poDate: getVal("poStart"),
                prdName: row.dPrdName,
                totalPrice: totalPrice,
                poStatus: getVal("poStatus"),
                payMethod: getVal("payMethod"),
                notes: getVal("notes"),
                vatType: getVal("vatDocType"),
                poType: getVal("bizType"),
                productCode: row.productCode,
                orderQty: toNum(row.orderQty),
                unitPrice: toNum(row.unitPrice),
                dcPrice: toNum(row.dcPrice),
                supAmt: supAmt,
                vatAmt: vatAmt,
                dPrdName: row.dPrdName,
              };

              if (!body.cusNo) return alert("ê±°ë˜ì²˜ë¥¼ ì§€ì •í•´ì£¼ì„¸ìš”.");
              await axios.post("/api/biz/poinsert", body);
              alert("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
              resetAll();
            } catch (e) {
              console.error(e);
              alert("ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
          };
          byId("btnSubmit").addEventListener("click", submit);

          // ===== ì´ˆê¸°í™” =====
          function resetAll() {
            setVal("poStart", today);
            setVal("exDate", today);
            setVal("settleDue", today);
            setVal("cusNo", "");
            setVal("cusName", "");
            setVal("creater", "");
            setVal("bizType", "VAT_INCLUDED");
            setVal("vatDocType", "TAX_INVOICE");
            setVal("payMethod", "CASH");
            setVal("poStatus", "WRITTEN");
            setVal("notes", "");
            byId("billDates").classList.add("d-none");
            gridApi.setRowData([
              {
                productCode: "",
                dPrdName: "",
                unitPrice: null,
                orderQty: null,
                dcPrice: null,
              },
            ]);
            updatePinned();
          }
          byId("btnReset").addEventListener("click", resetAll);

          // ===== ì£¼ë¬¸ì„œì¡°íšŒ ëª¨ë‹¬ =====
          const poHistoryModalEl = document.getElementById("PoHistoryModal");
          let poHistoryGridApi;
          const poHistoryColumnDefs = [
            { headerName: "", checkboxSelection: true, width: 50 },
            { headerName: "ì‘ì„±ì¼ì", field: "poStart", width: 120 },
            {
              headerName: "ê±°ë˜ì²˜ëª…",
              field: "cusName",
              flex: 1,
              minWidth: 150,
            },
            { headerName: "ë‹´ë‹¹ì", field: "creater", width: 100 },
            {
              headerName: "ëŒ€í‘œ í’ˆëª©ëª…",
              field: "prdName",
              flex: 1,
              minWidth: 180,
            },
            { headerName: "ë‚©ê¸°ì¼ì", field: "exDate", width: 120 },
            {
              headerName: "ì´ì•¡",
              field: "totalPrice",
              width: 150,
              type: "rightAligned",
              valueFormatter: (p) =>
                p.value ? p.value.toLocaleString("ko-KR") : "",
            },
          ];
          const poHistoryGridOptions = {
            columnDefs: poHistoryColumnDefs,
            rowSelection: "multiple",
            rowMultiSelectWithClick: true,
            rowData: [],
            defaultColDef: { sortable: true, resizable: true, filter: true },
            onGridReady: (params) => {
              poHistoryGridApi = params.api;
            },
          };
          async function fetchPoHistoryData() {
            if (!poHistoryGridApi) return;
            try {
              const response = await axios.get("/api/biz/pohistory");
              poHistoryGridApi.setRowData(response.data);
              poHistoryGridApi.sizeColumnsToFit();
            } catch (error) {
              console.error("ì£¼ë¬¸ ì´ë ¥ ì¡°íšŒ ì‹¤íŒ¨:", error);
              alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
          }
          if (poHistoryModalEl) {
            poHistoryModalEl.addEventListener("shown.bs.modal", () => {
              if (!poHistoryGridApi) {
                const gridDiv = document.getElementById("poHistoryGrid");
                if (window.agGrid?.createGrid) {
                  poHistoryGridApi = agGrid.createGrid(
                    gridDiv,
                    poHistoryGridOptions
                  );
                } else {
                  poHistoryGridApi = poHistoryGridOptions.api;
                }
              }
              fetchPoHistoryData();
            });

            const importBtn = document.getElementById("PohImportBtn");
            if (importBtn) {
              importBtn.addEventListener("click", () => {
                const selectedRows = poHistoryGridApi.getSelectedRows();
                if (!selectedRows || selectedRows.length === 0) {
                  return alert("ê°€ì ¸ì˜¬ ì£¼ë¬¸ì„œì˜ í–‰ì„ ì„ íƒí•˜ì„¸ìš”.");
                }

                const newItems = selectedRows.map((row) => ({
                  productCode: "",
                  dPrdName: row.prdName,
                  unitPrice: null,
                  orderQty: null,
                  dcPrice: null,
                  notes: `${row.poStart} ì£¼ë¬¸ ê±´ì—ì„œ ê°€ì ¸ì˜´`,
                }));

                gridApi.applyTransaction({ add: newItems });
                updatePinned();

                const modal = bootstrap.Modal.getInstance(poHistoryModalEl);
                modal?.hide();
              });
            } else {
              console.warn(
                "ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼(#PohImportBtn)ì„ modal HTMLì— ì¶”ê°€í•´ì£¼ì„¸ìš”."
              );
            }
          }
          // ===== í’ˆëª©ì½”ë“œ ì¡°íšŒ ëª¨ë‹¬ =====
          const productModalEl = document.getElementById("productcodeModal");
          let productGridApi;
          const productColumnDefs = [
            { headerName: "", checkboxSelection: true, width: 50 },
            { headerName: "í’ˆëª©ì½”ë“œ", field: "productCode", width: 140 },
            {
              headerName: "í’ˆëª©ëª…",
              field: "productName",
              flex: 1,
              minWidth: 160,
            },
          ];
          if (productModalEl) {
            productModalEl.addEventListener("shown.bs.modal", () => {
              const gridDiv = document.getElementById("productGrid");
              if (!productGridApi) {
                if (window.agGrid?.createGrid) {
                  productGridApi = agGrid.createGrid(
                    gridDiv,
                    productGridOptions
                  );
                } else {
                  productGridApi = productGridOptions.api;
                }
              }
              fetchProductData();
            });
          }
          const productGridOptions = {
            columnDefs: productColumnDefs,
            rowSelection: "multiple",
            rowMultiSelectWithClick: true,
            rowData: [],
            defaultColDef: { sortable: true, resizable: true, filter: true },
            onGridReady: (p) => {
              productGridApi = p.api;
            },
          };

          async function fetchProductData() {
            if (!productGridApi) return;
            try {
              const { data } = await axios.get("/api/biz/productcode");
              productGridApi.setRowData(data || []);
              productGridApi.sizeColumnsToFit?.();
            } catch (err) {
              console.error("í’ˆëª© ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:", err);
              alert("í’ˆëª© ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
          }

          // í’ˆëª©ì½”ë“œ ëª¨ë‹¬ì˜ ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
          const importProductBtn = document.getElementById("PrcImportBtn");
          if (importProductBtn) {
            importProductBtn.addEventListener("click", () => {
              const selectedRows = productGridApi.getSelectedRows();
              if (!selectedRows || selectedRows.length === 0) {
                return alert("ê°€ì ¸ì˜¬ í’ˆëª©ì„ ì„ íƒí•˜ì„¸ìš”.");
              }

              const newItems = selectedRows.map((row) => ({
                productCode: row.productCode,
                dPrdName: row.productName,
                unitPrice: row.unitPrice || null,
                orderQty: null,
                dcPrice: null,
                notes: "",
              }));

              gridApi.applyTransaction({ add: newItems });
              updatePinned();

              const modal = bootstrap.Modal.getInstance(productModalEl);
              modal?.hide();
            });
          } else {
            console.warn(
              "ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼(#PrcImportBtn)ì„ modal HTMLì— ì¶”ê°€í•´ì£¼ì„¸ìš”."
            );
          }
        });
      </script>
    </th:block>
  </body>
</html>
