<!DOCTYPE html>
<html>
<head>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    crossorigin="anonymous"
  />
  <meta charset="UTF-8">
  <title>Form with Master Grid Card</title>
</head>
<body class="bg-light">
<!-- 컨테이너 시작 -->
<div class="container py-5">
  <!-- 마스터 카드 -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">제품 등록 페이지</h5>
    </div>
  </div>
	 <!-- 버튼 영역 (폼 전체 최상단 오른쪽) -->
  <div class="d-flex justify-content-end mb-3">
    <button type="submit" class="btn btn-primary me-2" id="submitBtn">등록</button>
    <button type="reset" class="btn btn-danger" form="insertProductForm">초기화</button>
  </div>
  <!-- 폼 카드 -->
  <div class="card shadow-sm">
    <div class="card-body">
      <form action="/api/v1/stock/productInsert" class="row g-3" id="insertProductForm"  method="post" enctype="multipart/form-data">
        <div class="col-md-4">
          <label for="productName" class="form-label">제품명</label>
          <input type="text" class="form-control" id="productName" name="productName">
        </div>
        <div class="col-md-4">
          <label for="specification" class="form-label">규격</label>
          <input type="text" class="form-control" id="specification" name="specification">
        </div>
      	<div class="col-4">
          <label for="inputAddress" class="form-label">등록일자</label>
          <input type="date" class="form-control" id="insertDate" name="insertDate">
        </div>
        <div class="col-md-4">
          <label for="empName" class="form-label">등록자</label>
          <input type="text" class="form-control" id="empName" name="empName">
        </div>
        <div class="col-md-4">
          <label for="imgfile" class="form-label">이미지</label>
          <input class="form-control" type="file" id="imgFile" name="productImage">
        </div>
        <div class="col-4">
          <label for="note" class="form-label">비고</label>
          <textarea class="form-control" placeholder="Leave a comment here" id="note" name="note" maxlength="30" rows="1"></textarea>
        </div>
        <div class="col-md-4">
          <label for="purchasePrice" class="form-label">구매단가</label>
          <input type="text" class="form-control" id="purchasePrice" name="purchasePrice">
        </div>
        <div class="col-md-4">
          <label for="salesPrice" class="form-label">판매단가</label>
          <input type="text" class="form-control" id="salesPrice" name="salesPrice">
        </div>
      </form>
    </div>
  </div>
  
  <!-- 상세 이미지 카드 (기본 hidden) -->
  <div id="imageCard" class="card shadow-sm mb-4" style="display: none;">
    <div class="card-header bg-secondary text-white">
      <h6 class="mb-0">이미지 미리보기</h6>
    </div>
    <div class="card-body text-center">
      <img id="previewImage" src="" alt="이미지 미리보기" class="img-fluid"  style="max-width: 300px; max-height: 300px;">
      <p id="imageName" class="mt-2"></p>
    </div>
  </div>
  
  <!-- Toast (닫기 버튼 제거) -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 11">
  <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-body" id="toastMessage">등록 성공!</div>
  </div>
</div>
  
  <!-- 컨테이너 종료 -->
</div>

 <!-- Axios 등록 -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
 <!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <!-- 스크립트 -->
<script>
 // Image preview 및 URI 쪼개기
  const imgInput = document.getElementById('imgFile');
  const imageCard = document.getElementById('imageCard');
  const prevImg = document.getElementById('previewImage');
  const imageName = document.getElementById('imageName');

  imgInput.addEventListener('change', function(event) {
    const file = event.target.files[0]; // 한 장만 선택
    if (!file) {
      imageCard.style.display = 'none';
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
    	prevImg.src = e.target.result; // 폼에서 선택한 파일 기준
      imageName.textContent = file.name;
      imageCard.style.display = 'block';
    };
    reader.readAsDataURL(file);
  });
  
  // Axios 등록 + Toast
	const form = document.getElementById('insertProductForm');
	const submitBtn = document.getElementById('submitBtn');
	const toastEl = document.getElementById('successToast');
	const toast = new bootstrap.Toast(toastEl);
	
	submitBtn.addEventListener('click', (event) => {
		event.preventDefault(); // 페이지 새로고침 방지
	    const formData = new FormData(form);
	
	    axios.post('/api/v1/stock/productInsert', formData, {
	        headers: { 'Content-Type': 'multipart/form-data' }
	    })
	    .then(response => {
	        toast.show(); // Toast 알림
	        form.reset();  // 폼 초기화
	        document.getElementById('imageCard').style.display = 'none'; // 미리보기 숨김
	    })
	    .catch(error => {
	        alert('등록 실패: ' + error.response.data.message || error.message);
	    });
	});
  
  
</script>


</body>
</html>
